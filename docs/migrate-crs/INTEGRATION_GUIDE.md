# åŠŸèƒ½æ¨¡å—æ•´åˆåˆ°å…¶ä»–é¡¹ç›®æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•å°†å„åŠŸèƒ½æ¨¡å—æ•´åˆåˆ°å…¶ä»–é¡¹ç›®ä¸­ï¼ŒåŒ…æ‹¬æ¨¡å—ä¾èµ–åˆ†æã€æ–‡ä»¶æ¸…å•ã€æ•´åˆé¡ºåºå’Œé€‚é…è¦ç‚¹ã€‚

---

## ç›®å½•

1. [åŠŸèƒ½æ¨¡å—æ¦‚è§ˆ](#1-åŠŸèƒ½æ¨¡å—æ¦‚è§ˆ)
2. [æ¨¡å—ä¾èµ–å…³ç³»å›¾](#2-æ¨¡å—ä¾èµ–å…³ç³»å›¾)
3. [åŸºç¡€ä¾èµ–å±‚ï¼ˆå¿…é¡»å…ˆæ•´åˆï¼‰](#3-åŸºç¡€ä¾èµ–å±‚å¿…é¡»å…ˆæ•´åˆ)
4. [åŠŸèƒ½æ¨¡å—è¯¦è§£](#4-åŠŸèƒ½æ¨¡å—è¯¦è§£)
5. [æ¨èæ•´åˆé¡ºåº](#5-æ¨èæ•´åˆé¡ºåº)
6. [æ•´åˆæ–¹æ¡ˆé€‰æ‹©](#6-æ•´åˆæ–¹æ¡ˆé€‰æ‹©)
7. [é€‚é…æ”¹é€ è¦ç‚¹](#7-é€‚é…æ”¹é€ è¦ç‚¹)
8. [æ¥å£å¯¹æ¥è¯´æ˜](#8-æ¥å£å¯¹æ¥è¯´æ˜)

---

## 1. åŠŸèƒ½æ¨¡å—æ¦‚è§ˆ

| æ¨¡å— | ç‹¬ç«‹æ€§ | ä¾èµ–å¤æ‚åº¦ | ä»£ç é‡ | ç§»æ¤éš¾åº¦ |
|------|--------|------------|--------|----------|
| ğŸ“§ é‚®ä»¶æœåŠ¡ | â­â­â­â­â­ å®Œå…¨ç‹¬ç«‹ | ä½ | ~330è¡Œ | ç®€å• |
| ğŸ æ´»åŠ¨ä¼˜æƒ  | â­â­â­â­ åŸºæœ¬ç‹¬ç«‹ | ä½ | ~580è¡Œ | ç®€å• |
| ğŸ‘¥ é‚€è¯·è¿”åˆ© | â­â­â­â­ åŸºæœ¬ç‹¬ç«‹ | ä½ | ~540è¡Œ | ç®€å• |
| ğŸ’µ ç”¨æˆ·ä½™é¢ | â­â­â­ éœ€é€‚é… | ä¸­ | ~1200è¡Œ | ä¸­ç­‰ |
| ğŸ’° æ”¯ä»˜ç³»ç»Ÿ | â­â­ ä¾èµ–å¤š | é«˜ | ~1600è¡Œ | å¤æ‚ |
| ğŸ” æœ¬åœ°è®¤è¯ | â­â­â­ éœ€é€‚é… | ä¸­ | ~800è¡Œ | ä¸­ç­‰ |

---

## 2. æ¨¡å—ä¾èµ–å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          åŸºç¡€ä¾èµ–å±‚ (å¿…é¡»)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Redis  â”‚  â”‚  Logger â”‚  â”‚  Config â”‚  â”‚ crypto  â”‚  â”‚  bcrypt â”‚       â”‚
â”‚  â”‚  æ¨¡å‹   â”‚  â”‚  å·¥å…·   â”‚  â”‚  é…ç½®   â”‚  â”‚ (å†…ç½®)  â”‚  â”‚  (npm)  â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                           â”‚                           â”‚
        â–¼                           â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ğŸ“§ é‚®ä»¶æœåŠ¡  â”‚          â”‚  ğŸ æ´»åŠ¨ä¼˜æƒ   â”‚          â”‚  ğŸ‘¥ é‚€è¯·è¿”åˆ©   â”‚
â”‚  EmailService â”‚          â”‚PromotionSvc   â”‚          â”‚ ReferralSvc   â”‚
â”‚               â”‚          â”‚               â”‚          â”‚               â”‚
â”‚ ä¾èµ–:         â”‚          â”‚ ä¾èµ–:         â”‚          â”‚ ä¾èµ–:         â”‚
â”‚ - nodemailer  â”‚          â”‚ - Redis       â”‚          â”‚ - Redis       â”‚
â”‚ - Config      â”‚          â”‚ - Logger      â”‚          â”‚ - Config      â”‚
â”‚ - Logger      â”‚          â”‚               â”‚          â”‚ - Logger      â”‚
â”‚               â”‚          â”‚ æ— æœåŠ¡ä¾èµ– âœ…  â”‚          â”‚ æ— æœåŠ¡ä¾èµ– âœ…  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                           â”‚                           â”‚
        â”‚                           â”‚                           â”‚
        â–¼                           â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ğŸ’µ ç”¨æˆ·ä½™é¢/è®¤è¯æ¨¡å—                             â”‚
â”‚                           UserService                                   â”‚
â”‚                                                                         â”‚
â”‚  ä¾èµ–: Redis, Config, Logger, bcrypt, node-cache                        â”‚
â”‚  åŠŸèƒ½: ä½™é¢ç®¡ç†, å……å€¼è®°å½•, æœ¬åœ°è®¤è¯, å¯†ç ç®¡ç†                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ğŸ’° æ”¯ä»˜ç³»ç»Ÿæ¨¡å—                                 â”‚
â”‚                          PaymentService                                 â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚ ZpayService â”‚    â”‚StripeService â”‚  â† æ”¯ä»˜æ¸ é“ï¼ˆå¯é€‰æ‹©æ€§æ•´åˆï¼‰          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚                                                                         â”‚
â”‚  ä¾èµ–: UserService, PromotionService, ReferralService                   â”‚
â”‚  åŠŸèƒ½: è®¢å•ç®¡ç†, æ”¯ä»˜å›è°ƒ, è‡ªåŠ¨å……å€¼                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. åŸºç¡€ä¾èµ–å±‚ï¼ˆå¿…é¡»å…ˆæ•´åˆï¼‰

### 3.1 Redis æ¨¡å‹é€‚é…

**åŸé¡¹ç›®æ–‡ä»¶**: `src/models/redis.js`

**æ ¸å¿ƒæ–¹æ³•ï¼ˆéœ€é€‚é…æˆ–å®ç°ï¼‰**:

```javascript
// å¿…é¡»å®ç°çš„æ–¹æ³•
redis.getClient()        // è·å– Redis å®¢æˆ·ç«¯
redis.getClientSafe()    // è·å– Redis å®¢æˆ·ç«¯ï¼ˆå®‰å…¨ç‰ˆæœ¬ï¼‰
redis.get(key)           // è·å–å€¼
redis.set(key, value)    // è®¾ç½®å€¼
redis.setex(key, ttl, value)  // è®¾ç½®å¸¦è¿‡æœŸæ—¶é—´çš„å€¼
redis.del(key)           // åˆ é™¤é”®

// å¦‚æœæ‚¨çš„é¡¹ç›®å·²æœ‰ Redis å°è£…ï¼Œåªéœ€ç¡®ä¿ä»¥ä¸Šæ–¹æ³•å¯ç”¨
```

**é€‚é…æ–¹æ¡ˆ**:

```javascript
// æ–¹æ¡ˆA: ç›´æ¥å¤ç”¨åŸé¡¹ç›® redis.js
// å¤åˆ¶ src/models/redis.js åˆ°æ‚¨çš„é¡¹ç›®

// æ–¹æ¡ˆB: åˆ›å»ºé€‚é…å™¨åŒ…è£…æ‚¨ç°æœ‰çš„ Redis å®¢æˆ·ç«¯
class RedisAdapter {
  constructor(existingClient) {
    this.client = existingClient;
  }

  getClient() { return this.client; }
  getClientSafe() { return this.client; }

  async get(key) { return this.client.get(key); }
  async set(key, value) { return this.client.set(key, value); }
  async setex(key, ttl, value) { return this.client.setex(key, ttl, value); }
  async del(key) { return this.client.del(key); }
}
```

### 3.2 Logger é€‚é…

**åŸé¡¹ç›®æ–‡ä»¶**: `src/utils/logger.js`

**æ ¸å¿ƒæ–¹æ³•**:

```javascript
logger.info(message, meta)
logger.warn(message, meta)
logger.error(message, error)
logger.debug(message, meta)
logger.success(message, meta)  // å¯é€‰ï¼Œå¯æ˜ å°„åˆ° info
```

**é€‚é…æ–¹æ¡ˆ**:

```javascript
// æ–¹æ¡ˆA: å¤ç”¨åŸé¡¹ç›® logger
// å¤åˆ¶ src/utils/logger.js

// æ–¹æ¡ˆB: æ˜ å°„åˆ°æ‚¨ç°æœ‰çš„æ—¥å¿—ç³»ç»Ÿ
const logger = {
  info: (msg, meta) => console.log('[INFO]', msg, meta),
  warn: (msg, meta) => console.warn('[WARN]', msg, meta),
  error: (msg, err) => console.error('[ERROR]', msg, err),
  debug: (msg, meta) => console.debug('[DEBUG]', msg, meta),
  success: (msg, meta) => console.log('[SUCCESS]', msg, meta),
};
```

### 3.3 Config é€‚é…

æ¯ä¸ªåŠŸèƒ½æ¨¡å—éœ€è¦çš„é…ç½®é¡¹ä¸åŒï¼Œåœ¨å„æ¨¡å—è¯¦è§£ä¸­è¯´æ˜ã€‚

---

## 4. åŠŸèƒ½æ¨¡å—è¯¦è§£

### 4.1 ğŸ“§ é‚®ä»¶æœåŠ¡ (EmailService)

**ç‹¬ç«‹æ€§**: â­â­â­â­â­ å®Œå…¨ç‹¬ç«‹ï¼Œæœ€å®¹æ˜“æ•´åˆ

**æ–‡ä»¶æ¸…å•**:
```
src/services/emailService.js     # æ ¸å¿ƒæœåŠ¡ (~330è¡Œ)
```

**ä¾èµ–**:
- `nodemailer` (npm åŒ…)
- `config.email.*` (é…ç½®)
- `logger` (æ—¥å¿—)

**æ‰€éœ€é…ç½®**:
```javascript
config.email = {
  enabled: true,
  smtp: {
    host: 'smtp.example.com',
    port: 465,
    secure: true,
    auth: { user: 'xxx', pass: 'xxx' }
  },
  from: { name: 'æœåŠ¡å', address: 'noreply@example.com' },
  baseUrl: 'https://your-domain.com',
  tokenTTL: {
    passwordReset: 3600,      // 1å°æ—¶
    emailVerification: 86400  // 24å°æ—¶
  },
  features: {
    allowPasswordReset: true,
    requireEmailVerification: false
  }
}
```

**æ•´åˆæ­¥éª¤**:
1. å¤åˆ¶ `emailService.js`
2. å®‰è£…ä¾èµ–: `npm install nodemailer`
3. æ·»åŠ é…ç½®é¡¹
4. ä¿®æ”¹ require è·¯å¾„

**æä¾›çš„åŠŸèƒ½**:
- `sendEmail(options)` - å‘é€é‚®ä»¶
- `sendPasswordResetEmail(email, token, username)` - å¯†ç é‡ç½®é‚®ä»¶
- `sendEmailVerificationEmail(email, token, username)` - é‚®ç®±éªŒè¯é‚®ä»¶

---

### 4.2 ğŸ æ´»åŠ¨ä¼˜æƒ  (PromotionService)

**ç‹¬ç«‹æ€§**: â­â­â­â­ åŸºæœ¬ç‹¬ç«‹

**æ–‡ä»¶æ¸…å•**:
```
src/services/promotionService.js  # æ ¸å¿ƒæœåŠ¡ (~580è¡Œ)
```

**ä¾èµ–**:
- `redis` (æ•°æ®å­˜å‚¨)
- `logger` (æ—¥å¿—)
- `crypto` (Node.js å†…ç½®)

**âš ï¸ æ— å…¶ä»–æœåŠ¡ä¾èµ–ï¼Œå¯ç‹¬ç«‹è¿è¡Œ**

**æ‰€éœ€é…ç½®** (é€šè¿‡ç¯å¢ƒå˜é‡):
```bash
PROMOTION_ENABLED=true
PROMOTION_TIER1_BONUS=30    # 24å°æ—¶å†… 30%
PROMOTION_TIER2_BONUS=20    # 36å°æ—¶å†… 20%
PROMOTION_TIER3_BONUS=10    # 48å°æ—¶å†… 10%
PROMOTION_TIER4_BONUS=5     # 72å°æ—¶å†… 5%
PROMOTION_MIN_AMOUNT=0
PROMOTION_DURATION_HOURS=72
```

**Redis Key ç»“æ„**:
```
user_promotion:{userId}      # ç”¨æˆ·æ´»åŠ¨çŠ¶æ€ (String/JSON)
promotion_stats:*            # æ´»åŠ¨ç»Ÿè®¡
promotion_record:{recordId}  # æ´»åŠ¨è®°å½•
```

**æ•´åˆæ­¥éª¤**:
1. å¤åˆ¶ `promotionService.js`
2. é€‚é… redis å’Œ logger å¼•ç”¨
3. é…ç½®ç¯å¢ƒå˜é‡

**æä¾›çš„åŠŸèƒ½**:
- `initUserPromotion(userId, username)` - åˆå§‹åŒ–ç”¨æˆ·æ´»åŠ¨
- `getUserPromotion(userId)` - è·å–ç”¨æˆ·æ´»åŠ¨çŠ¶æ€
- `applyPromotion(userId, amount)` - è¯„ä¼°å¹¶åº”ç”¨ä¼˜æƒ 
- `markPromotionUsed(userId, tier, amount, bonus)` - æ ‡è®°æ´»åŠ¨å·²ä½¿ç”¨
- `getPromotionStats()` - è·å–æ´»åŠ¨ç»Ÿè®¡

**è°ƒç”¨ç¤ºä¾‹**:
```javascript
// ç”¨æˆ·æ³¨å†Œæ—¶åˆå§‹åŒ–æ´»åŠ¨
await promotionService.initUserPromotion(userId, username);

// ç”¨æˆ·å……å€¼æ—¶è¯„ä¼°ä¼˜æƒ 
const result = await promotionService.applyPromotion(userId, 100);
// result: { amount: 100, bonus: 30, total: 130, applied: true, tier: 0 }

// å¦‚æœ applied=trueï¼Œæ‰§è¡Œå……å€¼åæ ‡è®°æ´»åŠ¨å·²ä½¿ç”¨
if (result.applied) {
  await promotionService.markPromotionUsed(userId, result.tier, amount, result.bonus);
}
```

---

### 4.3 ğŸ‘¥ é‚€è¯·è¿”åˆ© (ReferralService)

**ç‹¬ç«‹æ€§**: â­â­â­â­ åŸºæœ¬ç‹¬ç«‹

**æ–‡ä»¶æ¸…å•**:
```
src/services/referralService.js  # æ ¸å¿ƒæœåŠ¡ (~540è¡Œ)
```

**ä¾èµ–**:
- `redis` (æ•°æ®å­˜å‚¨)
- `config.referralProgram.*` (é…ç½®)
- `config.payment.exchangeRate` (æ±‡ç‡ï¼Œå¯é€‰)
- `logger` (æ—¥å¿—)
- `crypto` (Node.js å†…ç½®)

**âš ï¸ æ— å…¶ä»–æœåŠ¡ä¾èµ–ï¼Œå¯ç‹¬ç«‹è¿è¡Œ**

**æ‰€éœ€é…ç½®**:
```javascript
config.referralProgram = {
  enabled: true,
  linkBaseUrl: 'https://your-domain.com/register',
  rewardUsd: 10,                    // è¿”åˆ©é‡‘é¢
  qualifiedRechargeCny: 20,         // è¾¾æ ‡é‡‘é¢ï¼ˆäººæ°‘å¸ï¼‰
  qualifiedRechargeTypes: ['payment'], // ä»…åœ¨çº¿æ”¯ä»˜è®¡å…¥
  maxRewardsPerInvitee: 1,
  maxInviteesPerUser: 0,            // 0=ä¸é™
  codeLength: 8,
  rulesDescription: 'è¿”åˆ©è§„åˆ™è¯´æ˜...'
}

config.payment = {
  exchangeRate: 7.2  // æ±‡ç‡ï¼ˆç”¨äº CNY/USD æ¢ç®—ï¼‰
}
```

**Redis Key ç»“æ„**:
```
referral:code:{code}           # é‚€è¯·ç  â†’ ç”¨æˆ·ID
referral:user:{userId}:code    # ç”¨æˆ·ID â†’ é‚€è¯·ç 
referral:invite:{inviteeId}    # é‚€è¯·è®°å½•
referral:user:{userId}:invitees # ç”¨æˆ·çš„è¢«é‚€è¯·äººåˆ—è¡¨
referral:stats:{userId}        # ç”¨æˆ·é‚€è¯·ç»Ÿè®¡
```

**æ•´åˆæ­¥éª¤**:
1. å¤åˆ¶ `referralService.js`
2. é€‚é… redis, config, logger å¼•ç”¨
3. æ·»åŠ é…ç½®é¡¹

**æä¾›çš„åŠŸèƒ½**:
- `getOrCreateReferralCode(userId)` - è·å–/åˆ›å»ºé‚€è¯·ç 
- `findUserIdByCode(code)` - é€šè¿‡é‚€è¯·ç æŸ¥æ‰¾ç”¨æˆ·
- `recordInvitation({inviteeId, inviteeUsername, referrerId, ...})` - è®°å½•é‚€è¯·å…³ç³»
- `processInviteeRecharge({inviteeId, totalRechargeUsd, rechargeAmountUsd, recordType})` - å¤„ç†è¢«é‚€è¯·äººå……å€¼
- `markRewardIssued(inviteeId, rewardAmountUsd)` - æ ‡è®°è¿”åˆ©å·²å‘æ”¾
- `getReferralInfo(userId)` - è·å–é‚€è¯·ä¿¡æ¯
- `listInvitees(userId, options)` - è·å–è¢«é‚€è¯·äººåˆ—è¡¨

**è°ƒç”¨ç¤ºä¾‹**:
```javascript
// ç”¨æˆ·æ³¨å†Œæ—¶ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰é‚€è¯·ç 
const inviterCode = req.query.inviter;
if (inviterCode) {
  const referrerId = await referralService.findUserIdByCode(inviterCode);
  if (referrerId) {
    await referralService.recordInvitation({
      inviteeId: newUserId,
      inviteeUsername: username,
      referrerId,
      referrerUsername: referrerUsername
    });
  }
}

// ç”¨æˆ·å……å€¼åï¼Œæ£€æŸ¥æ˜¯å¦è§¦å‘è¿”åˆ©
const reward = await referralService.processInviteeRecharge({
  inviteeId: userId,
  totalRechargeUsd: user.totalRecharge,
  rechargeAmountUsd: amount,
  recordType: 'payment'  // ä»…åœ¨çº¿æ”¯ä»˜
});

if (reward) {
  // ç»™é‚€è¯·äººå‘æ”¾è¿”åˆ©
  await userService.rechargeBalance(reward.referrerId, reward.rewardAmountUsd, ...);
  await referralService.markRewardIssued(reward.inviteeId, reward.rewardAmountUsd);
}
```

---

### 4.4 ğŸ’µ ç”¨æˆ·ä½™é¢ç³»ç»Ÿ

**ç‹¬ç«‹æ€§**: â­â­â­ éœ€è¦é€‚é…

**æ–‡ä»¶æ¸…å•**:
```
src/services/userService.js  # æ ¸å¿ƒæœåŠ¡ï¼ˆä½™é¢ç›¸å…³éƒ¨åˆ† ~1200è¡Œï¼‰
```

**ä¾èµ–**:
- `redis` (æ•°æ®å­˜å‚¨)
- `bcrypt` (å¯†ç å“ˆå¸Œ)
- `node-cache` (å†…å­˜ç¼“å­˜)
- `config` (é…ç½®)
- `logger` (æ—¥å¿—)
- `crypto` (Node.js å†…ç½®)

**æ ¸å¿ƒåŠŸèƒ½æ–¹æ³•ï¼ˆå»ºè®®æå–ï¼‰**:

```javascript
// ä½™é¢ç®¡ç†
async getBalanceInfo(userId)                    // è·å–ä½™é¢ä¿¡æ¯
async rechargeBalance(userId, amount, operator, remark, options)  // å……å€¼
async deductBalance(userId, amount, operator, remark, options)    // æ‰£å‡
async getRechargeRecords(userId, options)       // è·å–å……å€¼è®°å½•
async getAllRechargeRecords(options)            // è·å–æ‰€æœ‰å……å€¼è®°å½•

// ç”¨æˆ·æ•°æ®ç»“æ„æ–°å¢å­—æ®µ
{
  balance: 0,           // è´¦æˆ·ä½™é¢ï¼ˆç¾å…ƒï¼‰
  totalRecharge: 0,     // ç´¯è®¡å……å€¼ï¼ˆç¾å…ƒï¼‰
  lastRechargeAt: null  // æœ€åå……å€¼æ—¶é—´
}
```

**Redis Key ç»“æ„**:
```
user:{userId}                    # ç”¨æˆ·æ•°æ®ï¼ˆåŒ…å«ä½™é¢å­—æ®µï¼‰
recharge_record:{recordId}       # å……å€¼è®°å½•
recharge_records:user:{userId}   # ç”¨æˆ·å……å€¼è®°å½•åˆ—è¡¨
recharge_records:all             # å…¨å±€å……å€¼è®°å½•åˆ—è¡¨
```

**æ•´åˆæ–¹æ¡ˆ**:

**æ–¹æ¡ˆA: ç›´æ¥æ•´åˆåˆ°ç°æœ‰ UserService**
```javascript
// åœ¨æ‚¨ç°æœ‰çš„ UserService ä¸­æ·»åŠ ä»¥ä¸‹æ–¹æ³•

class UserService {
  // ... æ‚¨ç°æœ‰çš„æ–¹æ³• ...

  // æ–°å¢ä½™é¢ç›¸å…³æ–¹æ³•
  async getBalanceInfo(userId) { /* ä»åŸé¡¹ç›®å¤åˆ¶ */ }
  async rechargeBalance(userId, amount, operator, remark, options) { /* ä»åŸé¡¹ç›®å¤åˆ¶ */ }
  async deductBalance(userId, amount, operator, remark, options) { /* ä»åŸé¡¹ç›®å¤åˆ¶ */ }
  async getRechargeRecords(userId, options) { /* ä»åŸé¡¹ç›®å¤åˆ¶ */ }
}
```

**æ–¹æ¡ˆB: åˆ›å»ºç‹¬ç«‹ BalanceService**
```javascript
// æ–°å»º src/services/balanceService.js
// å°†ä½™é¢ç›¸å…³åŠŸèƒ½ç‹¬ç«‹å‡ºæ¥ï¼Œå‡å°‘ä¸ UserService çš„è€¦åˆ

class BalanceService {
  async getBalance(userId) {}
  async addBalance(userId, amount, operator, remark, options) {}
  async deductBalance(userId, amount, operator, remark, options) {}
  async getRecords(userId, options) {}
}
```

---

### 4.5 ğŸ’° æ”¯ä»˜ç³»ç»Ÿ

**ç‹¬ç«‹æ€§**: â­â­ ä¾èµ–æœ€å¤šï¼Œæ•´åˆæœ€å¤æ‚

**æ–‡ä»¶æ¸…å•**:
```
src/services/paymentService.js   # æ”¯ä»˜æœåŠ¡æŠ½è±¡å±‚ (~730è¡Œ)
src/services/zpayService.js      # ZPAY æ”¯ä»˜æ¸ é“ (~250è¡Œ)
src/services/stripeService.js    # Stripe æ”¯ä»˜æ¸ é“ (~300è¡Œ)
src/routes/paymentRoutes.js      # æ”¯ä»˜è·¯ç”± (~320è¡Œ)
```

**ä¾èµ–**:
- `userService` - ç”¨æˆ·ä½™é¢æ“ä½œ
- `promotionService` - æ´»åŠ¨ä¼˜æƒ è®¡ç®—
- `referralService` - é‚€è¯·è¿”åˆ©ï¼ˆå¯é€‰ï¼Œåœ¨å›è°ƒä¸­è§¦å‘ï¼‰
- `zpayService` / `stripeService` - æ”¯ä»˜æ¸ é“
- `redis`, `config`, `logger`

**æ‰€éœ€é…ç½®**:
```javascript
config.payment = {
  enabled: true,
  baseUrl: 'https://your-domain.com',
  minAmount: 1,
  maxAmount: 10000,
  defaultCurrency: 'CNY',
  displayCurrency: 'USD',
  exchangeRate: 7.2,
  discountRate: 1,
  orderExpireMinutes: 30,
  maxOrdersPerMinute: 3,
  packages: [],  // å……å€¼å¥—é¤ï¼ˆå¯é€‰ï¼‰

  zpay: {
    enabled: true,
    pid: 'xxx',
    key: 'xxx',
    apiUrl: 'https://zpayz.cn',
    // ... æ›´å¤šé…ç½®
  },

  stripe: {
    enabled: false,
    apiKey: 'sk_xxx',
    // ... æ›´å¤šé…ç½®
  }
}
```

**Redis Key ç»“æ„**:
```
payment_order:{orderId}         # è®¢å•è¯¦æƒ…
payment_orders_user:{userId}    # ç”¨æˆ·è®¢å•åˆ—è¡¨
payment_orders_all              # å…¨å±€è®¢å•åˆ—è¡¨
payment_order_trade:{tradeNo}   # äº¤æ˜“å·â†’è®¢å•IDæ˜ å°„
payment_rate_limit:{userId}     # è®¢å•é€Ÿç‡é™åˆ¶
```

**æ•´åˆæ­¥éª¤**:
1. å…ˆæ•´åˆåŸºç¡€ä¾èµ–ï¼ˆç”¨æˆ·ä½™é¢ã€æ´»åŠ¨ä¼˜æƒ ç­‰ï¼‰
2. å¤åˆ¶æ”¯ä»˜ç›¸å…³æ–‡ä»¶
3. é€‚é…æœåŠ¡ä¾èµ–å¼•ç”¨
4. æ·»åŠ æ”¯ä»˜è·¯ç”±
5. é…ç½®æ”¯ä»˜æ¸ é“

**æ”¯ä»˜æµç¨‹**:
```
åˆ›å»ºè®¢å• â†’ è°ƒç”¨æ”¯ä»˜æ¸ é“ â†’ ç”¨æˆ·æ”¯ä»˜ â†’ æ”¯ä»˜å›è°ƒ
                                         â†“
                              éªŒè¯å›è°ƒ â†’ æ›´æ–°è®¢å•çŠ¶æ€
                                         â†“
                              å……å€¼ä½™é¢ â†’ åº”ç”¨æ´»åŠ¨ä¼˜æƒ 
                                         â†“
                              å¤„ç†é‚€è¯·è¿”åˆ©ï¼ˆå¦‚æœ‰ï¼‰
```

---

### 4.6 ğŸ” æœ¬åœ°è®¤è¯å¢å¼º

**æ–‡ä»¶ä½ç½®**: `src/services/userService.js` ä¸­çš„è®¤è¯ç›¸å…³æ–¹æ³•

**æ ¸å¿ƒæ–¹æ³•**:
```javascript
// ç”¨æˆ·æ³¨å†Œ/ç™»å½•
async registerLocalUser(userData)           // æœ¬åœ°ç”¨æˆ·æ³¨å†Œ
async authenticateLocalUser(username, password)  // æœ¬åœ°ç”¨æˆ·è®¤è¯

// å¯†ç ç®¡ç†
async _hashPassword(password)               // bcrypt å“ˆå¸Œ
async verifyPassword(password, passwordHash) // éªŒè¯å¯†ç 
async updateUserPassword(userId, oldPassword, newPassword)  // ä¿®æ”¹å¯†ç 
async resetUserPassword(userId, newPassword)  // ç®¡ç†å‘˜é‡ç½®å¯†ç 

// å¯†ç é‡ç½®æµç¨‹
async generatePasswordResetToken(email)     // ç”Ÿæˆé‡ç½® Token
async resetPasswordWithToken(token, newPassword)  // ä½¿ç”¨ Token é‡ç½®

// é‚®ç®±éªŒè¯
async generateEmailVerificationToken(userId)  // ç”ŸæˆéªŒè¯ Token
async verifyEmail(token)                     // éªŒè¯é‚®ç®±
```

**ä¾èµ–**:
- `bcrypt` - å¯†ç å“ˆå¸Œ
- `emailService` - å‘é€é‡ç½®/éªŒè¯é‚®ä»¶ï¼ˆå¯é€‰ï¼‰
- `redis`, `config`, `logger`, `crypto`

---

## 5. æ¨èæ•´åˆé¡ºåº

### 5.1 æœ€å°å¯è¡Œæ•´åˆï¼ˆä»…æ ¸å¿ƒåŠŸèƒ½ï¼‰

```
Step 1: åŸºç¡€ä¾èµ–é€‚é…
        â””â”€â”€ Redis æ¨¡å‹ + Logger + Config
              â”‚
Step 2: ç”¨æˆ·ä½™é¢ç³»ç»Ÿ
        â””â”€â”€ ä½™é¢ç®¡ç† + å……å€¼è®°å½•
              â”‚
Step 3: (å¯é€‰) æ”¯ä»˜ç³»ç»Ÿ
        â””â”€â”€ è®¢å•ç®¡ç† + æ”¯ä»˜å›è°ƒ
```

### 5.2 å®Œæ•´åŠŸèƒ½æ•´åˆ

```
Step 1: åŸºç¡€ä¾èµ–é€‚é…
        â”œâ”€â”€ Redis æ¨¡å‹é€‚é…
        â”œâ”€â”€ Logger é€‚é…
        â””â”€â”€ Config ç»“æ„å®šä¹‰
              â”‚
Step 2: ç‹¬ç«‹æ¨¡å—ï¼ˆå¯å¹¶è¡Œï¼‰
        â”œâ”€â”€ ğŸ“§ é‚®ä»¶æœåŠ¡ (EmailService)
        â”œâ”€â”€ ğŸ æ´»åŠ¨ä¼˜æƒ  (PromotionService)
        â””â”€â”€ ğŸ‘¥ é‚€è¯·è¿”åˆ© (ReferralService)
              â”‚
Step 3: ç”¨æˆ·ä½™é¢ç³»ç»Ÿ
        â””â”€â”€ ğŸ’µ ä½™é¢ç®¡ç† + å……å€¼è®°å½• + æœ¬åœ°è®¤è¯
              â”‚
Step 4: æ”¯ä»˜ç³»ç»Ÿ
        â”œâ”€â”€ ğŸ’° PaymentService (æ ¸å¿ƒ)
        â”œâ”€â”€ ZpayService (ZPAY æ¸ é“)
        â””â”€â”€ StripeService (Stripe æ¸ é“)
              â”‚
Step 5: è·¯ç”±å’Œ API
        â”œâ”€â”€ æ”¯ä»˜è·¯ç”± (paymentRoutes.js)
        â””â”€â”€ ç”¨æˆ·è·¯ç”±æ‰©å±• (ä½™é¢ã€æ´»åŠ¨ã€é‚€è¯·)
              â”‚
Step 6: å‰ç«¯ç»„ä»¶ï¼ˆå¯é€‰ï¼‰
        â”œâ”€â”€ PromotionBanner.vue
        â”œâ”€â”€ UserRechargeRecords.vue
        â””â”€â”€ å…¶ä»– UI ç»„ä»¶
```

---

## 6. æ•´åˆæ–¹æ¡ˆé€‰æ‹©

### 6.1 æ–¹æ¡ˆA: å®Œæ•´å¤åˆ¶

**é€‚ç”¨åœºæ™¯**: ç›®æ ‡é¡¹ç›®ç»“æ„ç›¸ä¼¼ï¼Œå¸Œæœ›å¿«é€Ÿæ•´åˆå…¨éƒ¨åŠŸèƒ½

**æ­¥éª¤**:
1. å¤åˆ¶æ‰€æœ‰ç›¸å…³æœåŠ¡æ–‡ä»¶
2. å¤åˆ¶è·¯ç”±æ–‡ä»¶
3. ä¿®æ”¹ require è·¯å¾„
4. æ·»åŠ é…ç½®é¡¹
5. æ³¨å†Œè·¯ç”±

**ä¼˜ç‚¹**: å¿«é€Ÿã€å®Œæ•´
**ç¼ºç‚¹**: å¯èƒ½å¼•å…¥ä¸éœ€è¦çš„ä»£ç 

### 6.2 æ–¹æ¡ˆB: æŒ‰éœ€æ•´åˆ

**é€‚ç”¨åœºæ™¯**: åªéœ€è¦éƒ¨åˆ†åŠŸèƒ½ï¼Œæˆ–é¡¹ç›®ç»“æ„å·®å¼‚è¾ƒå¤§

**æ­¥éª¤**:
1. ç¡®å®šéœ€è¦çš„åŠŸèƒ½æ¨¡å—
2. ä»…å¤åˆ¶ç›¸å…³æ–‡ä»¶
3. æå–æ ¸å¿ƒæ–¹æ³•
4. é€‚é…åˆ°ç°æœ‰æœåŠ¡ç»“æ„

**ä¼˜ç‚¹**: ç²¾ç®€ã€çµæ´»
**ç¼ºç‚¹**: éœ€è¦æ›´å¤šé€‚é…å·¥ä½œ

### 6.3 æ–¹æ¡ˆC: å¾®æœåŠ¡åŒ–

**é€‚ç”¨åœºæ™¯**: å¤§å‹é¡¹ç›®ï¼Œå¸Œæœ›åŠŸèƒ½è§£è€¦

**æ­¥éª¤**:
1. å°†æ”¯ä»˜ç³»ç»Ÿä½œä¸ºç‹¬ç«‹æœåŠ¡
2. é€šè¿‡ HTTP/æ¶ˆæ¯é˜Ÿåˆ— ä¸ä¸»æœåŠ¡é€šä¿¡
3. ç‹¬ç«‹éƒ¨ç½²å’Œç»´æŠ¤

**æ¶æ„ç¤ºæ„**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     HTTP API     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸»æœåŠ¡      â”‚ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  æ”¯ä»˜æœåŠ¡     â”‚
â”‚  (ç”¨æˆ·ç®¡ç†)   â”‚                  â”‚ (è®¢å•/å›è°ƒ)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                                         â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  ZPAY    â”‚                              â”‚  Stripe  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. é€‚é…æ”¹é€ è¦ç‚¹

### 7.1 ç”¨æˆ· ID æ ¼å¼é€‚é…

åŸé¡¹ç›®ä½¿ç”¨ UUID æ ¼å¼ç”¨æˆ· IDã€‚å¦‚æœæ‚¨çš„é¡¹ç›®ä½¿ç”¨å…¶ä»–æ ¼å¼ï¼ˆå¦‚è‡ªå¢ IDï¼‰ï¼Œéœ€è¦é€‚é…ï¼š

```javascript
// åŸé¡¹ç›®
generateUserId() {
  return crypto.randomUUID();
}

// é€‚é…ä¸ºæ‚¨çš„æ ¼å¼
generateUserId() {
  return yourIdGenerator();  // ä½¿ç”¨æ‚¨é¡¹ç›®çš„ ID ç”Ÿæˆé€»è¾‘
}
```

### 7.2 è´§å¸å•ä½é€‚é…

åŸé¡¹ç›®ä½™é¢ä»¥ç¾å…ƒ (USD) ä¸ºå•ä½ã€‚å¦‚æœæ‚¨éœ€è¦ä½¿ç”¨å…¶ä»–è´§å¸ï¼š

```javascript
// æ–¹æ¡ˆ1: ç»§ç»­ä½¿ç”¨ USDï¼Œä»…åœ¨æ˜¾ç¤ºæ—¶è½¬æ¢
const displayAmount = balance * exchangeRate;

// æ–¹æ¡ˆ2: ä¿®æ”¹ä¸ºæ‚¨çš„åŸºå‡†è´§å¸
// éœ€è¦ä¿®æ”¹æ‰€æœ‰æ¶‰åŠé‡‘é¢çš„åœ°æ–¹
```

### 7.3 ç”¨æˆ·æ•°æ®ç»“æ„é€‚é…

åŸé¡¹ç›®ç”¨æˆ·æ•°æ®å­˜å‚¨åœ¨ Redisã€‚å¦‚æœæ‚¨ä½¿ç”¨ MySQL/MongoDBï¼š

```javascript
// åŸé¡¹ç›® (Redis)
await redis.set(`user:${userId}`, JSON.stringify(userData));

// é€‚é…ä¸º MySQL
await User.update({ balance, totalRecharge }, { where: { id: userId } });

// é€‚é…ä¸º MongoDB
await User.updateOne({ _id: userId }, { $set: { balance, totalRecharge } });
```

### 7.4 å……å€¼è®°å½•å­˜å‚¨é€‚é…

```javascript
// åŸé¡¹ç›® (Redis List)
await redis.lpush(`recharge_records:user:${userId}`, recordId);

// é€‚é…ä¸ºå…³ç³»å‹æ•°æ®åº“
await RechargeRecord.create({
  id: recordId,
  userId,
  amount,
  type,
  remark,
  createdAt: new Date()
});
```

---

## 8. æ¥å£å¯¹æ¥è¯´æ˜

### 8.1 æ ¸å¿ƒæ¥å£æ¸…å•

#### ä½™é¢ç®¡ç†

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/users/balance` | GET | è·å–ç”¨æˆ·ä½™é¢ |
| `/admin/users/:userId/recharge` | POST | ç®¡ç†å‘˜å……å€¼ |
| `/admin/users/:userId/deduct` | POST | ç®¡ç†å‘˜æ‰£æ¬¾ |
| `/users/recharge-records` | GET | è·å–å……å€¼è®°å½• |

#### æ”¯ä»˜ç›¸å…³

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/payment/config` | GET | è·å–æ”¯ä»˜é…ç½® |
| `/payment/orders` | POST | åˆ›å»ºè®¢å• |
| `/payment/orders` | GET | è®¢å•åˆ—è¡¨ |
| `/payment/orders/:orderId` | GET | è®¢å•è¯¦æƒ… |
| `/payment/webhook/zpay` | POST/GET | ZPAY å›è°ƒ |
| `/payment/webhook/stripe` | POST | Stripe å›è°ƒ |

#### æ´»åŠ¨ä¼˜æƒ 

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/users/promotion/status` | GET | è·å–æ´»åŠ¨çŠ¶æ€ |

#### é‚€è¯·è¿”åˆ©

| æ¥å£ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|
| `/users/referral/info` | GET | è·å–é‚€è¯·ä¿¡æ¯ |
| `/users/referral/invitees` | GET | è·å–è¢«é‚€è¯·äººåˆ—è¡¨ |

### 8.2 æœåŠ¡è°ƒç”¨ç¤ºä¾‹

```javascript
// åœ¨æ‚¨çš„ä¸šåŠ¡ä»£ç ä¸­è°ƒç”¨

// 1. ç”¨æˆ·å……å€¼æ—¶åº”ç”¨æ´»åŠ¨ä¼˜æƒ 
const promotion = await promotionService.applyPromotion(userId, amount);
const finalAmount = promotion.applied ? promotion.total : amount;
await userService.rechargeBalance(userId, finalAmount, operator, remark);
if (promotion.applied) {
  await promotionService.markPromotionUsed(userId, promotion.tier, amount, promotion.bonus);
}

// 2. æ”¯ä»˜å›è°ƒå¤„ç†
app.post('/payment/webhook/zpay', async (req, res) => {
  await paymentService.handleCallback('zpay', req.body);
  res.send('success');
});

// 3. ç”¨æˆ·æ³¨å†Œæ—¶å¤„ç†é‚€è¯·å…³ç³»
const inviterCode = req.body.inviterCode;
if (inviterCode) {
  const referrerId = await referralService.findUserIdByCode(inviterCode);
  if (referrerId) {
    await referralService.recordInvitation({ inviteeId, referrerId, ... });
  }
}
```

---

## é™„å½•: å¿«é€Ÿå‚è€ƒ

### A. npm ä¾èµ–

```bash
npm install bcrypt node-cache p-limit nodemailer stripe
```

### B. ç¯å¢ƒå˜é‡æ¨¡æ¿

```bash
# é‚®ä»¶æœåŠ¡
EMAIL_ENABLED=false
SMTP_HOST=
SMTP_PORT=465
SMTP_USER=
SMTP_PASS=

# æ´»åŠ¨ä¼˜æƒ 
PROMOTION_ENABLED=false
PROMOTION_TIER1_BONUS=30

# é‚€è¯·è¿”åˆ©
REFERRAL_PROGRAM_ENABLED=false
REFERRAL_REWARD_USD=10

# æ”¯ä»˜
PAYMENT_ENABLED=false
ZPAY_ENABLED=false
ZPAY_PID=
ZPAY_KEY=
STRIPE_ENABLED=false
STRIPE_SECRET_KEY=
```

### C. æ–‡ä»¶å¤åˆ¶æ¸…å•

```bash
# æ ¸å¿ƒæœåŠ¡
src/services/emailService.js
src/services/promotionService.js
src/services/referralService.js
src/services/paymentService.js
src/services/zpayService.js
src/services/stripeService.js

# è·¯ç”±
src/routes/paymentRoutes.js

# é…ç½®ï¼ˆå‚è€ƒï¼‰
config/config.example.js
```
