# =============================================================================
# Sub2API Docker Environment Configuration
# =============================================================================
# Copy this file to .env and modify as needed:
#   cp .env.example .env
#   nano .env
#
# Then start with: docker-compose up -d
# =============================================================================

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------
# Bind address for host port mapping
BIND_HOST=0.0.0.0

# Server port (exposed on host)
SERVER_PORT=8080

# Server mode: release or debug
SERVER_MODE=release

# 运行模式: standard (默认) 或 simple (内部自用)
# standard: 完整 SaaS 功能，包含计费/余额校验；simple: 隐藏 SaaS 功能并跳过计费/余额校验
RUN_MODE=standard

# Timezone
TZ=Asia/Shanghai

# -----------------------------------------------------------------------------
# PostgreSQL Configuration (REQUIRED)
# -----------------------------------------------------------------------------
POSTGRES_USER=sub2api
POSTGRES_PASSWORD=change_this_secure_password
POSTGRES_DB=sub2api

# -----------------------------------------------------------------------------
# Redis Configuration
# -----------------------------------------------------------------------------
# Leave empty for no password (default for local development)
REDIS_PASSWORD=
REDIS_DB=0

# -----------------------------------------------------------------------------
# Admin Account
# -----------------------------------------------------------------------------
# Email for the admin account
ADMIN_EMAIL=admin@sub2api.local

# Password for admin account
# Leave empty to auto-generate (will be shown in logs on first run)
ADMIN_PASSWORD=

# -----------------------------------------------------------------------------
# JWT Configuration
# -----------------------------------------------------------------------------
# Leave empty to auto-generate (recommended)
JWT_SECRET=
JWT_EXPIRE_HOUR=24

# -----------------------------------------------------------------------------
# Gemini OAuth (OPTIONAL, required only for Gemini OAuth accounts)
# -----------------------------------------------------------------------------
# Sub2API supports TWO Gemini OAuth modes:
#
# 1. Code Assist OAuth (需要 GCP project_id)
#    - Uses: cloudcode-pa.googleapis.com (Code Assist API)
#    - Auto scopes: cloud-platform + userinfo.email + userinfo.profile
#    - OAuth Client: Can use built-in Gemini CLI client (留空即可)
#    - Requires: Google Cloud Platform project with Code Assist enabled
#
# 2. AI Studio OAuth (不需要 project_id)
#    - Uses: generativelanguage.googleapis.com (AI Studio API)
#    - Default scopes: generative-language
#    - OAuth Client: Requires your own OAuth 2.0 Client (内置 Gemini CLI client 不能申请 generative-language scope)
#    - Requires: Create OAuth 2.0 Client in GCP Console + OAuth consent screen
#    - Setup Guide: https://ai.google.dev/gemini-api/docs/oauth
#    - ⚠️ IMPORTANT: OAuth Client 必须发布为正式版本 (Production)
#      Testing 模式限制: 只能添加 100 个测试用户, refresh token 7 天后过期
#      发布步骤: GCP Console → OAuth consent screen → PUBLISH APP
#
# Configuration:
# Leave empty to use the built-in Gemini CLI OAuth client (Code Assist OAuth only).
# To enable AI Studio OAuth, set your own OAuth client ID/secret here.
GEMINI_OAUTH_CLIENT_ID=
GEMINI_OAUTH_CLIENT_SECRET=
# Optional; leave empty to auto-select scopes based on oauth_type
GEMINI_OAUTH_SCOPES=

# -----------------------------------------------------------------------------
# Payment / Recharge (OPTIONAL)
# -----------------------------------------------------------------------------
# Enables the new frontend pages:
#   - /payment (recharge plans + "my orders" as recharge records)
#
# Notes:
# - When PAYMENT_ENABLED=false, you can still view plans, but creating orders will fail.
# - Frontend pay methods are "Alipay / WeChat":
#   - Alipay => provider ZPay
#   - WeChat => provider Stripe
# - When providers are enabled and configured correctly, creating an order will return `pay_url` (and sometimes `qr_url`).
#   The frontend will render QR code from `pay_url` and poll order status until paid/expired/failed.
# - PAYMENT_PACKAGES is optional; if omitted, the app uses built-in defaults from config.go.
#
# Enable payment module
PAYMENT_ENABLED=false

# Pricing and order settings
# Public base URL used to resolve relative notify/return URLs (required if you keep notify/return as relative paths)
PAYMENT_BASE_URL=
PAYMENT_MIN_AMOUNT=1.0
PAYMENT_MAX_AMOUNT=10000.0
PAYMENT_EXCHANGE_RATE=7.2
# Discount rate in (0,1], e.g. 0.15 means "pay 15%"
PAYMENT_DISCOUNT_RATE=0.15
PAYMENT_ORDER_EXPIRE_MINUTES=30
PAYMENT_MAX_ORDERS_PER_MINUTE=3

# Recharge plans (JSON array)
# Note: UI displays `label` directly; recommended to keep it in USD (e.g. "$100")
# Example (exchange_rate=7.2, discount_rate=0.15 => pay 15%):
# PAYMENT_PACKAGES='[{"amount_usd":100,"label":"$100","popular":false},{"amount_usd":200,"label":"$200","popular":false},{"amount_usd":500,"label":"$500","popular":true},{"amount_usd":1000,"label":"$1000","popular":false}]'
PAYMENT_PACKAGES=

# ZPay (WIP)
# NOTE:
# - This repo reads env vars via Viper with '.' -> '_' mapping, so the prefix is `PAYMENT_`.
# - This repo ALSO supports legacy env var names (without `PAYMENT_`), such as `ZPAY_ENABLED` / `STRIPE_SECRET_KEY`.
#   Prefer the `PAYMENT_` prefixed variables for new deployments.
PAYMENT_ZPAY_ENABLED=false
PAYMENT_ZPAY_PID=
PAYMENT_ZPAY_KEY=
PAYMENT_ZPAY_API_URL=https://zpayz.cn
PAYMENT_ZPAY_SUBMIT_URL=https://zpayz.cn/submit.php
PAYMENT_ZPAY_QUERY_URL=https://zpayz.cn/api.php
PAYMENT_ZPAY_PAYMENT_METHODS=alipay,wxpay
PAYMENT_ZPAY_ORDER_PREFIX=ORD_
# You can use either `/api/payment/webhook/zpay` or `/payment/zpay/notify` (both are routed to the same handler)
PAYMENT_ZPAY_NOTIFY_URL=/payment/zpay/notify
PAYMENT_ZPAY_RETURN_URL=/payment/zpay/return
PAYMENT_ZPAY_NOTIFY_USER=false
PAYMENT_ZPAY_IP_WHITELIST=
PAYMENT_ZPAY_REQUIRE_HTTPS=true

# Stripe (WIP)
PAYMENT_STRIPE_ENABLED=false
PAYMENT_STRIPE_API_KEY=
PAYMENT_STRIPE_WEBHOOK_SECRET=
PAYMENT_STRIPE_API_VERSION=
PAYMENT_STRIPE_PAYMENT_METHODS=wechat_pay
PAYMENT_STRIPE_CURRENCY=CNY
PAYMENT_STRIPE_SUCCESS_URL=/payment/return/stripe?order={ORDER_ID}&status=success
PAYMENT_STRIPE_CANCEL_URL=/payment/return/stripe?order={ORDER_ID}&status=cancel
PAYMENT_STRIPE_WECHAT_CLIENT=web
PAYMENT_STRIPE_WECHAT_APP_ID=

# -----------------------------------------------------------------------------
# Legacy payment env vars (OPTIONAL)
# -----------------------------------------------------------------------------
# If you already have a CRS-style deployment, you can keep using these names.
# They will be mapped to `payment.*` automatically.
#
# ==================== ZPAY 配置 ====================
# ZPAY_ENABLED=true
# ZPAY_PID=
# ZPAY_KEY=
# ZPAY_API_URL=https://zpayz.cn
# ZPAY_SUBMIT_URL=https://zpayz.cn/submit.php
# ZPAY_QUERY_URL=https://zpayz.cn/api.php
# ZPAY_PAYMENT_METHODS=alipay,wxpay
# ZPAY_ORDER_PREFIX=ORD_
# ZPAY_NOTIFY_URL=https://your-domain.example.com/payment/zpay/notify
# ZPAY_RETURN_URL=https://your-domain.example.com/payment/zpay/return
# ZPAY_NOTIFY_USER=false
# ZPAY_IP_WHITELIST=
# ZPAY_REQUIRE_HTTPS=true
#
# ==================== Stripe 配置 ====================
# STRIPE_ENABLED=true
# STRIPE_SECRET_KEY=sk_test_xxx
# STRIPE_WEBHOOK_SECRET=whsec_xxx
# STRIPE_API_VERSION=2024-06-20
# STRIPE_PAYMENT_METHODS=wechat_pay
# STRIPE_CURRENCY=CNY
# STRIPE_SUCCESS_URL=https://your-domain.example.com/payment/return/stripe?order={ORDER_ID}&status=success
# STRIPE_CANCEL_URL=https://your-domain.example.com/payment/return/stripe?order={ORDER_ID}&status=cancel
# STRIPE_WECHAT_CLIENT=web
# STRIPE_WECHAT_APP_ID=
