# =============================================================================
# Sub2API Docker Environment Configuration
# =============================================================================
# Copy this file to .env and modify as needed:
#   cp .env.example .env
#   nano .env
#
# Then start with: docker-compose up -d
# =============================================================================

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------
# Bind address for host port mapping
BIND_HOST=0.0.0.0

# Server port (exposed on host)
SERVER_PORT=8080

# Server mode: release or debug
SERVER_MODE=release

# 运行模式: standard (默认) 或 simple (内部自用)
# standard: 完整 SaaS 功能，包含计费/余额校验；simple: 隐藏 SaaS 功能并跳过计费/余额校验
RUN_MODE=standard

# Timezone
TZ=Asia/Shanghai

# -----------------------------------------------------------------------------
# Gateway Configuration
# -----------------------------------------------------------------------------
# Maximum request body size in bytes (default: 100MB)
# Common values:
#   - 10MB:  10485760   (text-only conversations)
#   - 20MB:  20971520   (single image analysis)
#   - 50MB:  52428800   (multiple images, 3-5 images)
#   - 100MB: 104857600  (default, general use)
#   - 200MB: 209715200  (enterprise/internal network)
GATEWAY_MAX_BODY_SIZE=104857600

# Wait time (in seconds) for upstream response headers (streaming body not affected)
GATEWAY_RESPONSE_HEADER_TIMEOUT=300

# Connection pool isolation strategy:
# - proxy: Isolate by proxy (shared pool per proxy)
# - account: Isolate by account (shared pool per account)
# - account_proxy: Isolate by account+proxy combination (default, most granular)
GATEWAY_CONNECTION_POOL_ISOLATION=account_proxy

# HTTP upstream connection pool configuration
GATEWAY_MAX_IDLE_CONNS=240
GATEWAY_MAX_IDLE_CONNS_PER_HOST=120
GATEWAY_MAX_CONNS_PER_HOST=240
GATEWAY_IDLE_CONN_TIMEOUT_SECONDS=300

# Upstream connection pool client cache configuration
GATEWAY_MAX_UPSTREAM_CLIENTS=5000
GATEWAY_CLIENT_IDLE_TTL_SECONDS=900

# Concurrency slot TTL (minutes)
GATEWAY_CONCURRENCY_SLOT_TTL_MINUTES=15

# Logging options
GATEWAY_LOG_UPSTREAM_ERROR_BODY=false
GATEWAY_LOG_UPSTREAM_ERROR_BODY_MAX_BYTES=2048

# Advanced options
GATEWAY_INJECT_BETA_FOR_APIKEY=false
GATEWAY_FAILOVER_ON_400=false

# TLS fingerprint simulation (uTLS) to mimic Claude CLI / Node.js
# Helps avoid upstream blocks that fingerprint non-official clients.
GATEWAY_TLS_FINGERPRINT_ENABLED=true

# -----------------------------------------------------------------------------
# Gateway Scheduling - Anthropic API-key Connectivity Monitor
# -----------------------------------------------------------------------------
# Periodically tests Anthropic API-key accounts by reusing the same request logic as the admin UI
# "Test Account Connection" endpoint:
#   POST /api/v1/admin/accounts/:id/test
#
# Behavior (default):
# - Every 10s: run a lightweight Claude test (upstream /v1/messages, max_tokens=1)
# - 6 consecutive failures  -> call "stop scheduling" (account.schedulable=false) + DingTalk abnormal alert
# - 6 consecutive successes -> call "enable scheduling" (account.schedulable=true)  + DingTalk recovery alert
#
# Notes:
# - Only applies to accounts: platform=anthropic AND type=apikey AND status=active
# - Recovery only auto-enables accounts previously auto-disabled by this monitor
# - DingTalk notifications require DINGTALK_ENABLED=true + webhook config
GATEWAY_SCHEDULING_ANTHROPIC_APIKEY_MONITOR_ENABLED=false
GATEWAY_SCHEDULING_ANTHROPIC_APIKEY_MONITOR_INTERVAL=10s
GATEWAY_SCHEDULING_ANTHROPIC_APIKEY_MONITOR_FAILURE_THRESHOLD=6
GATEWAY_SCHEDULING_ANTHROPIC_APIKEY_MONITOR_SUCCESS_THRESHOLD=6
GATEWAY_SCHEDULING_ANTHROPIC_APIKEY_MONITOR_REQUEST_TIMEOUT=8s
GATEWAY_SCHEDULING_ANTHROPIC_APIKEY_MONITOR_MAX_CONCURRENCY=4
# Optional: override the model used for test requests (default: claude-haiku-4-5-20251001; will apply account.model_mapping if configured)
GATEWAY_SCHEDULING_ANTHROPIC_APIKEY_MONITOR_MODEL_ID=
# Optional: restrict monitoring to specific account IDs (CSV: 1,2,3 or JSON: [1,2,3])
GATEWAY_SCHEDULING_ANTHROPIC_APIKEY_MONITOR_INCLUDE_ACCOUNT_IDS=
# Optional: skip monitoring for specific account IDs (CSV or JSON array)
GATEWAY_SCHEDULING_ANTHROPIC_APIKEY_MONITOR_EXCLUDE_ACCOUNT_IDS=

# -----------------------------------------------------------------------------
# PostgreSQL Configuration (REQUIRED)
# -----------------------------------------------------------------------------
# Database host (use 'postgres' for docker-compose, 'localhost' for local)
DATABASE_HOST=postgres
# Database port
DATABASE_PORT=5432
# Database user
POSTGRES_USER=sub2api
DATABASE_USER=sub2api
# Database password
POSTGRES_PASSWORD=change_this_secure_password
DATABASE_PASSWORD=change_this_secure_password
# Database name
POSTGRES_DB=sub2api
DATABASE_DBNAME=sub2api
# SSL mode: disable, require, verify-ca, verify-full
DATABASE_SSLMODE=disable

# -----------------------------------------------------------------------------
# Redis Configuration
# -----------------------------------------------------------------------------
# Redis host (use 'redis' for docker-compose, 'localhost' for local)
REDIS_HOST=redis
# Redis port
REDIS_PORT=6379
# Redis password (leave empty for no password)
REDIS_PASSWORD=
# Redis database number (0-15)
REDIS_DB=0

# -----------------------------------------------------------------------------
# Admin Account
# -----------------------------------------------------------------------------
# Email for the admin account
ADMIN_EMAIL=admin@sub2api.local

# Password for admin account
# Leave empty to auto-generate (will be shown in logs on first run)
ADMIN_PASSWORD=

# -----------------------------------------------------------------------------
# JWT Configuration
# -----------------------------------------------------------------------------
# IMPORTANT: Set a fixed JWT_SECRET to prevent login sessions from being
# invalidated after container restarts. If left empty, a random secret will
# be generated on each startup, causing all users to be logged out.
# Generate a secure secret: openssl rand -hex 32
JWT_SECRET=
JWT_EXPIRE_HOUR=24

# -----------------------------------------------------------------------------
# Default Settings
# -----------------------------------------------------------------------------
# Initial balance for new users (USD)
DEFAULT_USER_BALANCE=0

# Default concurrent requests limit per user
DEFAULT_USER_CONCURRENCY=5

# API key prefix for generated keys
DEFAULT_API_KEY_PREFIX=sk-

# Rate multiplier (affects billing calculation)
DEFAULT_RATE_MULTIPLIER=1.0

# -----------------------------------------------------------------------------
# Rate Limiting
# -----------------------------------------------------------------------------
# Cooldown time (in minutes) when upstream returns 529 (overloaded)
RATE_LIMIT_OVERLOAD_COOLDOWN_MINUTES=10

# -----------------------------------------------------------------------------
# Pricing Data Source (Optional)
# -----------------------------------------------------------------------------
# URL to fetch model pricing data (default: LiteLLM)
PRICING_REMOTE_URL=https://raw.githubusercontent.com/BerriAI/litellm/main/model_prices_and_context_window.json

# Hash verification URL (optional)
PRICING_HASH_URL=

# Local data directory for caching
PRICING_DATA_DIR=./data

# Fallback pricing file
PRICING_FALLBACK_FILE=./resources/model-pricing/model_prices_and_context_window.json

# Update interval in hours
PRICING_UPDATE_INTERVAL_HOURS=24

# Hash check interval in minutes
PRICING_HASH_CHECK_INTERVAL_MINUTES=10

# -----------------------------------------------------------------------------
# DingTalk Alerts (Optional)
# -----------------------------------------------------------------------------
# Used for operational notifications, e.g. account status abnormal alerts.
#
# Enable/disable DingTalk alert sending
DINGTALK_ENABLED=false

# Optional: environment label shown in DingTalk messages (e.g. prod/test/staging)
# If empty, no environment tag will be added.
DINGTALK_ENV=

# DingTalk group robot webhook URL
# Example: https://oapi.dingtalk.com/robot/send?access_token=...
DINGTALK_WEBHOOK_URL=

# Optional signing secret (when the robot is configured with "signature" security)
DINGTALK_SECRET=

# Mobile numbers to @ mention, comma-separated (optional)
DINGTALK_AT_MOBILES=

# Whether to @ all members
DINGTALK_AT_ALL=false

# Whether to send payment/recharge order notifications (e.g. Payment Paid/Failed/Cancelled).
# Set to false if you only want operational alerts such as account status abnormal.
DINGTALK_PAYMENT_NOTIFY_ENABLED=true

# -----------------------------------------------------------------------------
# Dingtalk Bot Recharge (Optional)
# -----------------------------------------------------------------------------
# Enable DingTalk bot balance operations
DINGTALK_BOT_ENABLED=false

# Optional access token validation
DINGTALK_BOT_ACCESS_TOKEN=

# Optional signature secret (timestamp/sign verification)
DINGTALK_BOT_SIGN_SECRET=

# Allowed sender IDs (staffId or senderId), comma-separated
DINGTALK_BOT_ALLOWED_SENDER_IDS=

# Default remark appended to balance adjustment orders
DINGTALK_BOT_DEFAULT_REMARK=

# -----------------------------------------------------------------------------
# Concurrency Configuration
# -----------------------------------------------------------------------------
# Ping interval for SSE connections (seconds)
CONCURRENCY_PING_INTERVAL=10

# -----------------------------------------------------------------------------
# Token Refresh (Optional)
# -----------------------------------------------------------------------------
# Enable automatic token refresh for upstream accounts
TOKEN_REFRESH_ENABLED=false

# Check interval (minutes)
TOKEN_REFRESH_CHECK_INTERVAL_MINUTES=60

# Refresh before expiry (hours)
TOKEN_REFRESH_REFRESH_BEFORE_EXPIRY_HOURS=24

# Max retries for refresh
TOKEN_REFRESH_MAX_RETRIES=3

# Retry backoff (seconds)
TOKEN_REFRESH_RETRY_BACKOFF_SECONDS=60

# -----------------------------------------------------------------------------
# Configuration File (Optional)
# -----------------------------------------------------------------------------
# Path to custom config file (relative to docker-compose.yml directory)
# Copy config.example.yaml to config.yaml and modify as needed
# Leave unset to use default ./config.yaml
CONFIG_FILE=./config.yaml

# -----------------------------------------------------------------------------
# Rate Limiting (Optional)
# 速率限制（可选）
# -----------------------------------------------------------------------------
# Cooldown time (in minutes) when upstream returns 529 (overloaded)
# 上游返回 529（过载）时的冷却时间（分钟）
RATE_LIMIT_OVERLOAD_COOLDOWN_MINUTES=10
# Fallback cooldown time (in minutes) when upstream returns 429 but reset time is missing/invalid
# 上游返回 429 但未提供可解析的重置时间时的兜底冷却时间（分钟）
RATE_LIMIT_FALLBACK_COOLDOWN_MINUTES=5

# -----------------------------------------------------------------------------
# Gateway Scheduling (Optional)
# 调度缓存与受控回源配置（缓存就绪且命中时不读 DB）
# -----------------------------------------------------------------------------
# Ops Monitoring (Optional)
# -----------------------------------------------------------------------------
# Ops monitoring module switch (default: true)
# - true: enable ops monitoring APIs/background jobs and show ops menu in UI
# - false: disable ops features and hide ops menu in UI
OPS_ENABLED=true
# -----------------------------------------------------------------------------
# 仪表盘聚合 / 使用日志保留（可选配置）
# -----------------------------------------------------------------------------
# 这些环境变量对应配置项：
#   dashboard_aggregation.*（包括 dashboard_aggregation.retention.*）
# 它们会在运行时覆盖 config.yaml，修改后需要重启服务才能生效。
#
# 当仪表盘聚合功能启用时，该任务还会执行保留期清理：
# - usage_logs 表中的数据会根据 DASHBOARD_AGGREGATION_RETENTION_USAGE_LOGS_DAYS 设置的天数进行删除。
# - 如果 usage_logs 是 PostgreSQL 分区表，可能会删除旧的月度分区。
# - 小时级/天级聚合表会根据各自的保留窗口进行清理。
#
# 如果你希望"暂时不删除 usage_logs 使用记录"：
# - 推荐做法：保持聚合功能开启，但将 usage_logs 保留天数设置得非常大（例如 36500 天 ≈ 100 年）
#   DASHBOARD_AGGREGATION_RETENTION_USAGE_LOGS_DAYS=36500
# - 或者：完全关闭聚合服务（这会影响仪表盘预聚合性能和统计刷新）
#   DASHBOARD_AGGREGATION_ENABLED=false
#
# 启用聚合任务（及保留期清理）
DASHBOARD_AGGREGATION_ENABLED=true
# 刷新间隔（秒）
DASHBOARD_AGGREGATION_INTERVAL_SECONDS=60
# 延迟数据回溯窗口（秒）
DASHBOARD_AGGREGATION_LOOKBACK_SECONDS=120
# 允许通过管理后台 API 手动回填数据
DASHBOARD_AGGREGATION_BACKFILL_ENABLED=false
# 回填最大时间范围（天），BACKFILL_ENABLED=true 时必须大于 0
DASHBOARD_AGGREGATION_BACKFILL_MAX_DAYS=31
# 启动时重新计算最近 N 天的数据（0 表示禁用重新计算）
DASHBOARD_AGGREGATION_RECOMPUTE_DAYS=2
# 原始 usage_logs 保留窗口（天），ENABLED=true 时必须大于 0
DASHBOARD_AGGREGATION_RETENTION_USAGE_LOGS_DAYS=90
# 小时级聚合数据保留窗口（天），ENABLED=true 时必须大于 0
DASHBOARD_AGGREGATION_RETENTION_HOURLY_DAYS=180
# 天级聚合数据保留窗口（天），ENABLED=true 时必须大于 0
DASHBOARD_AGGREGATION_RETENTION_DAILY_DAYS=730

# -----------------------------------------------------------------------------
# 使用记录清理任务（可选配置）
# -----------------------------------------------------------------------------
# 这些环境变量对应配置项：
#   usage_cleanup.*
# 这是由管理员触发的清理任务 worker（根据条件批量删除数据）。
#
# 注意事项：
# - 如果 USAGE_CLEANUP_ENABLED=false：
#   - worker 不会启动，因此清理任务不会删除任何数据行。
#   - 通过管理后台 API 创建/取消清理任务会返回"功能已禁用"。
#   - 查询现有任务列表仍然允许。
#
# 启用清理任务 worker
USAGE_CLEANUP_ENABLED=true
# 每次任务的最大日期范围（天）
USAGE_CLEANUP_MAX_RANGE_DAYS=31
# 批量删除大小（行数）
USAGE_CLEANUP_BATCH_SIZE=5000
# Worker 轮询间隔（秒）
USAGE_CLEANUP_WORKER_INTERVAL_SECONDS=10
# 任务执行超时时间（秒）
USAGE_CLEANUP_TASK_TIMEOUT_SECONDS=1800

# -----------------------------------------------------------------------------
# Security Configuration
# -----------------------------------------------------------------------------
# URL Allowlist Configuration
# 启用 URL 白名单验证（false 则跳过白名单检查，仅做基本格式校验）
SECURITY_URL_ALLOWLIST_ENABLED=false

# 关闭白名单时，是否允许 http:// URL（默认 false，只允许 https://）
# ⚠️ 警告：允许 HTTP 存在安全风险（明文传输），仅建议在开发/测试环境或可信内网中使用
# Allow insecure HTTP URLs when allowlist is disabled (default: false, requires https)
# ⚠️ WARNING: Allowing HTTP has security risks (plaintext transmission)
#             Only recommended for dev/test environments or trusted networks
SECURITY_URL_ALLOWLIST_ALLOW_INSECURE_HTTP=true

# 是否允许本地/私有 IP 地址用于上游/定价/CRS（仅在可信网络中使用）
# Allow localhost/private IPs for upstream/pricing/CRS (use only in trusted networks)
SECURITY_URL_ALLOWLIST_ALLOW_PRIVATE_HOSTS=true

# Upstream hosts allowlist (comma-separated; only used when SECURITY_URL_ALLOWLIST_ENABLED=true)
# Example:
# SECURITY_URL_ALLOWLIST_UPSTREAM_HOSTS=api.openai.com,api.anthropic.com,generativelanguage.googleapis.com,cloudcode-pa.googleapis.com,*.openai.azure.com
SECURITY_URL_ALLOWLIST_UPSTREAM_HOSTS=

# Read-only Admin API Key allowlist (optional)
# 只读管理员 API Key 白名单（可选）
#
# The read-only Admin API key (admin-ro-*) is restricted to:
# - GET method only
# - A path allowlist (exact match) and optional prefix allowlist
#
# 只读管理员 API Key（admin-ro-*）限制：
# - 仅允许 GET 方法
# - 仅允许访问以下白名单路径（以及可选的前缀白名单）
#
# Format:
# - CSV: /a,/b,/c
# - JSON: ["/a","/b","/c"]
#
# Example:
# SECURITY_ADMIN_API_KEY_READ_ONLY_ALLOWED_PATHS=/api/v1/admin/users/export,/api/v1/admin/usage,/api/v1/admin/payment/orders/export
# SECURITY_ADMIN_API_KEY_READ_ONLY_ALLOWED_PATH_PREFIXES=/api/v1/admin/users
SECURITY_ADMIN_API_KEY_READ_ONLY_ALLOWED_PATHS=
SECURITY_ADMIN_API_KEY_READ_ONLY_ALLOWED_PATH_PREFIXES=

# -----------------------------------------------------------------------------
# Gemini OAuth (OPTIONAL, required only for Gemini OAuth accounts)
# -----------------------------------------------------------------------------
# Sub2API supports TWO Gemini OAuth modes:
#
# 1. Code Assist OAuth (需要 GCP project_id)
#    - Uses: cloudcode-pa.googleapis.com (Code Assist API)
#    - Auto scopes: cloud-platform + userinfo.email + userinfo.profile
#    - OAuth Client: Can use built-in Gemini CLI client (留空即可)
#    - Requires: Google Cloud Platform project with Code Assist enabled
#
# 2. AI Studio OAuth (不需要 project_id)
#    - Uses: generativelanguage.googleapis.com (AI Studio API)
#    - Default scopes: generative-language
#    - OAuth Client: Requires your own OAuth 2.0 Client (内置 Gemini CLI client 不能申请 generative-language scope)
#    - Requires: Create OAuth 2.0 Client in GCP Console + OAuth consent screen
#    - Setup Guide: https://ai.google.dev/gemini-api/docs/oauth
#    - ⚠️ IMPORTANT: OAuth Client 必须发布为正式版本 (Production)
#      Testing 模式限制: 只能添加 100 个测试用户, refresh token 7 天后过期
#      发布步骤: GCP Console → OAuth consent screen → PUBLISH APP
#
# Configuration:
# Leave empty to use the built-in Gemini CLI OAuth client (Code Assist OAuth only).
# To enable AI Studio OAuth, set your own OAuth client ID/secret here.
GEMINI_OAUTH_CLIENT_ID=
GEMINI_OAUTH_CLIENT_SECRET=
# Optional; leave empty to auto-select scopes based on oauth_type
GEMINI_OAUTH_SCOPES=

# -----------------------------------------------------------------------------
# Gemini Quota Policy (OPTIONAL, local simulation)
# -----------------------------------------------------------------------------
# JSON overrides for local quota simulation (Code Assist only).
# Example:
# GEMINI_QUOTA_POLICY={"tiers":{"LEGACY":{"pro_rpd":50,"flash_rpd":1500,"cooldown_minutes":30},"PRO":{"pro_rpd":1500,"flash_rpd":4000,"cooldown_minutes":5},"ULTRA":{"pro_rpd":2000,"flash_rpd":0,"cooldown_minutes":5}}}
GEMINI_QUOTA_POLICY=

# -----------------------------------------------------------------------------
# Payment / Recharge (OPTIONAL)
# -----------------------------------------------------------------------------
# Enables the new frontend pages:
#   - /payment (recharge plans + "my orders" as recharge records)
#
# Notes:
# - When PAYMENT_ENABLED=false, you can still view plans, but creating orders will fail.
# - Frontend pay methods are "Alipay / WeChat":
#   - Alipay => provider ZPay
#   - WeChat => provider Stripe
# - When providers are enabled and configured correctly, creating an order will return `pay_url` (and sometimes `qr_url`).
#   The frontend will render QR code from `pay_url` and poll order status until paid/expired/failed.
# - PAYMENT_PACKAGES is optional; if omitted, the app uses built-in defaults from config.go.
#
# Enable payment module
PAYMENT_ENABLED=false

# Pricing and order settings
# Public base URL used to resolve relative notify/return URLs (required if you keep notify/return as relative paths)
PAYMENT_BASE_URL=
PAYMENT_MIN_AMOUNT=1.0
PAYMENT_MAX_AMOUNT=10000.0
PAYMENT_EXCHANGE_RATE=7.2
# Discount rate in (0,1], e.g. 0.15 means "pay 15%"
PAYMENT_DISCOUNT_RATE=0.15
PAYMENT_ORDER_EXPIRE_MINUTES=30
PAYMENT_MAX_ORDERS_PER_MINUTE=3
PAYMENT_ORDER_PREFIX=ORD_

# Recharge plans (JSON array)
# Note: UI displays `label` directly; recommended to keep it in USD (e.g. "$100")
# Example (exchange_rate=7.2, discount_rate=0.15 => pay 15%):
# PAYMENT_PACKAGES='[{"amount_usd":100,"label":"$100","popular":false},{"amount_usd":200,"label":"$200","popular":false},{"amount_usd":500,"label":"$500","popular":true},{"amount_usd":1000,"label":"$1000","popular":false}]'
PAYMENT_PACKAGES=

# ZPay (WIP)
# NOTE:
# - This repo reads env vars via Viper with '.' -> '_' mapping, so the prefix is `PAYMENT_`.
# - This repo ALSO supports legacy env var names (without `PAYMENT_`), such as `ZPAY_ENABLED` / `STRIPE_SECRET_KEY`.
#   Prefer the `PAYMENT_` prefixed variables for new deployments.
PAYMENT_ZPAY_ENABLED=false
PAYMENT_ZPAY_PID=
PAYMENT_ZPAY_KEY=
PAYMENT_ZPAY_API_URL=https://zpayz.cn
PAYMENT_ZPAY_SUBMIT_URL=https://zpayz.cn/submit.php
PAYMENT_ZPAY_QUERY_URL=https://zpayz.cn/api.php
PAYMENT_ZPAY_PAYMENT_METHODS=alipay,wxpay
# You can use either `/api/payment/webhook/zpay` or `/payment/zpay/notify` (both are routed to the same handler)
PAYMENT_ZPAY_NOTIFY_URL=/api/payment/webhook/zpay
PAYMENT_ZPAY_RETURN_URL=/payment/result
PAYMENT_ZPAY_NOTIFY_USER=false
PAYMENT_ZPAY_IP_WHITELIST=
PAYMENT_ZPAY_REQUIRE_HTTPS=true

# ZPay Multi-Channel Support (OPTIONAL)
# If you have multiple payment channels in ZPAY console (e.g., two WeChat Pay channels),
# you can configure channel-specific IDs here to specify which channel to use for each payment type.
# If left empty, ZPAY will randomly select an available channel.
#
# How to get Channel ID (CID):
# 1. Login to ZPAY console: https://z-pay.cn
# 2. Go to "会员中心" → "支付渠道"
# 3. Each channel has a unique Channel ID (CID)
#
# Example scenario:
# - Channel A (CID: 1234) for Alipay
# - Channel B (CID: 5678) for WeChat Pay
#
# Configuration (Both naming styles are supported):
# Style 1 (Recommended):
# PAYMENT_ZPAY_ALIPAY_CHANNEL_ID=1234  # Alipay channel ID (optional)
# PAYMENT_ZPAY_WECHAT_CHANNEL_ID=5678  # WeChat channel ID (optional)
#
# Style 2 (Alternative):
# ZPAY_ALIPAY_CHANNEL_ID=1234  # Alipay channel ID (optional)
# ZPAY_WECHAT_CHANNEL_ID=5678  # WeChat channel ID (optional)
#
# Note: You can use either PAYMENT_ZPAY_* or ZPAY_* prefix, both work.
PAYMENT_ZPAY_ALIPAY_CHANNEL_ID=
PAYMENT_ZPAY_WECHAT_CHANNEL_ID=

# Stripe (WIP)
PAYMENT_STRIPE_ENABLED=false
PAYMENT_STRIPE_API_KEY=
PAYMENT_STRIPE_WEBHOOK_SECRET=
PAYMENT_STRIPE_API_VERSION=
PAYMENT_STRIPE_PAYMENT_METHODS=wechat_pay
PAYMENT_STRIPE_CURRENCY=CNY
PAYMENT_STRIPE_SUCCESS_URL=/payment/return/stripe?order={ORDER_ID}&status=success
PAYMENT_STRIPE_CANCEL_URL=/payment/return/stripe?order={ORDER_ID}&status=cancel
PAYMENT_STRIPE_WECHAT_CLIENT=web
PAYMENT_STRIPE_WECHAT_APP_ID=

# -----------------------------------------------------------------------------
# Promotion (First Recharge Bonus) (OPTIONAL)
# -----------------------------------------------------------------------------
# New user first recharge bonus (only once).
#
# Notes:
# - The promotion window is based on user registration time.
# - PROMOTION_TIERS is optional; if omitted, the app uses built-in defaults from config.go.
PROMOTION_ENABLED=false
PROMOTION_DURATION_HOURS=72
PROMOTION_MIN_AMOUNT=0.0

# Promotion tiers (JSON array)
# Example:
# PROMOTION_TIERS='[{"hours":24,"bonus_percent":30},{"hours":36,"bonus_percent":20},{"hours":48,"bonus_percent":10},{"hours":72,"bonus_percent":5}]'
PROMOTION_TIERS=

# -----------------------------------------------------------------------------
# Referral Program (Invite & Reward) (OPTIONAL)
# -----------------------------------------------------------------------------
# Enables the `/referral` page and invite rewards.
REFERRAL_ENABLED=false

# Optional: prefer this base URL for invite links (e.g. "https://your-domain.com").
# If empty, backend falls back to PAYMENT_BASE_URL.
REFERRAL_BASE_URL=

# The frontend register route. Backend will convert to absolute URL if REFERRAL_BASE_URL (or PAYMENT_BASE_URL) is set.
REFERRAL_LINK_BASE_URL=/register

# Reward credits (USD) for the inviter, issued when invitee reaches the qualified amount.
REFERRAL_REWARD_USD=10

# Invitee qualified threshold. If both are set, REFERRAL_QUALIFIED_RECHARGE_USD takes precedence.
REFERRAL_QUALIFIED_RECHARGE_CNY=20
REFERRAL_QUALIFIED_RECHARGE_USD=0

# Code settings
REFERRAL_CODE_LENGTH=8
REFERRAL_MAX_INVITEES_PER_USER=0
